# ğŸš€ Guide d'installation NovaMail SaaS

## Vue d'ensemble

Ce guide dÃ©crit la procÃ©dure d'installation complÃ¨te du systÃ¨me NovaMail, depuis la configuration initiale jusqu'Ã  l'automatisation Tally â†’ Google Sheets â†’ Activation Client.

---

## ğŸ“‹ PrÃ©requis

- âœ… Compte Google (Gmail + Drive)
- âœ… Google Apps Script activÃ©
- âœ… Formulaire Tally connectÃ© Ã  Google Sheets
- âœ… Permissions Gmail pour envoi d'emails

---

## ğŸ› ï¸ Ã‰tape 1 : Structure des fichiers

### Organisation du projet Apps Script

CrÃ©ez un nouveau projet Google Apps Script et organisez les fichiers ainsi :

```
ğŸ“¦ NovaMail SaaS Project
â”œâ”€â”€ ğŸ“„ Config.gs              â†’ Configuration & versions
â”œâ”€â”€ ğŸ“„ Core.gs                â†’ Utilitaires rÃ©utilisables
â”œâ”€â”€ ğŸ“„ UserManagement.gs      â†’ Gestion utilisateurs
â”œâ”€â”€ ğŸ“„ SheetTriggers.gs       â†’ Automatisation Google Sheets
â”œâ”€â”€ ğŸ“„ Campaigns.gs           â†’ Logique campagnes (Ã  venir)
â”œâ”€â”€ ğŸ“„ Scheduling.gs          â†’ Planification (Ã  venir)
â”œâ”€â”€ ğŸ“„ History.gs             â†’ Historique (Ã  venir)
â”œâ”€â”€ ğŸ“„ API.gs                 â†’ Points d'entrÃ©e frontend (Ã  venir)
â””â”€â”€ ğŸ“„ index.html             â†’ Interface utilisateur
```

**Action requise :**
1. Copiez le contenu de chaque fichier artifact dans Apps Script
2. Respectez exactement les noms de fichiers
3. Sauvegardez le projet

---

## âš™ï¸ Ã‰tape 2 : Configuration Google Sheet

### Structure attendue du Google Sheet Tally

Votre Google Sheet doit contenir ces colonnes (ordre non important) :

| Colonne | Description | Obligatoire |
|---------|-------------|-------------|
| `Submission ID` | ID unique Tally | âœ… |
| `Respondent ID` | ID rÃ©pondant | âœ… |
| `Submitted at` | Date soumission | âœ… |
| `Nom complet` | Nom du client | âœ… |
| `Email de connexion` | Email principal | âœ… |
| `Email d'envoi` | Email expÃ©diteur (optionnel si = connexion) | âšª |
| `Email de rÃ©ponse (optionnel)` | Email pour rÃ©ponses | âšª |
| `Nom de l'entreprise / organisation` | Nom entreprise | âšª |
| `Version activÃ©e` | FREE / STARTER / PRO / BUSINESS | âœ… |
| `Consentement` | Acceptation CGU | âœ… |
| `Consentement (Accepter)` | Valeur boolÃ©enne | âœ… |

### Colonnes automatiques (ajoutÃ©es par le systÃ¨me)

Le systÃ¨me ajoutera automatiquement :

- `Statut activation` â†’ âœ… ActivÃ© / âŒ Erreur
- `Date activation` â†’ Date/heure
- `Lien personnel` â†’ URL espace client

**Action requise :**
1. Notez l'ID de votre Google Sheet (dans l'URL)
2. VÃ©rifiez que les colonnes correspondent exactement

---

## ğŸ”§ Ã‰tape 3 : DÃ©ploiement Web App

### 3.1 DÃ©ployer l'application web

1. Dans Apps Script, cliquez sur **DÃ©ployer** â†’ **Nouveau dÃ©ploiement**
2. Type : **Application Web**
3. Description : `NovaMail SaaS - Production`
4. ExÃ©cuter en tant que : **Moi**
5. AccÃ¨s : **Tout le monde** (pour liens clients)
6. Cliquez sur **DÃ©ployer**

### 3.2 RÃ©cupÃ©rer le Deployment ID

AprÃ¨s dÃ©ploiement, copiez l'URL gÃ©nÃ©rÃ©e :

```
https://script.google.com/macros/s/AKfycbzXXXXXXXXXXXXXXXXXX/exec
```

Le **Deployment ID** est la partie aprÃ¨s `/s/` :
```
AKfycbzXXXXXXXXXXXXXXXXXX
```

**âš ï¸ Conservez prÃ©cieusement cet ID !**

---

## ğŸ¬ Ã‰tape 4 : Installation automatisÃ©e

### 4.1 ExÃ©cuter la fonction d'installation

Dans l'Ã©diteur Apps Script :

1. Ouvrez le fichier `SheetTriggers.gs`
2. SÃ©lectionnez la fonction `setupNovaMail` dans le menu dÃ©roulant
3. Remplacez les valeurs dans la fonction :

```javascript
function runSetup() {
  const DEPLOYMENT_ID = "AKfycbzXXXXXXXXXXXXXXXXXX"; // â† Votre ID
  const SHEET_ID = "1abc...XYZ"; // â† ID de votre Google Sheet
  
  const result = setupNovaMail(DEPLOYMENT_ID, SHEET_ID);
  Logger.log(JSON.stringify(result, null, 2));
}
```

4. Cliquez sur **ExÃ©cuter** (â–¶ï¸)
5. Acceptez les autorisations demandÃ©es

### 4.2 VÃ©rifier l'installation

RÃ©sultat attendu dans les logs :

```json
{
  "success": true,
  "message": "NovaMail installÃ© et configurÃ© avec succÃ¨s.",
  "config": {
    "deploymentId": "AKfycbz...",
    "hasTimeTrigger": true,
    "errors": [],
    "warnings": []
  }
}
```

---

## ğŸ§ª Ã‰tape 5 : Test du systÃ¨me

### 5.1 Test manuel d'une ligne

Pour tester le traitement d'une ligne spÃ©cifique :

```javascript
// Dans Apps Script, exÃ©cutez :
manualProcessRow(2); // Traite la ligne 2 (premiÃ¨re soumission)
```

VÃ©rifiez dans les logs :
- âœ… Client crÃ©Ã© avec userId
- âœ… Email de bienvenue envoyÃ©
- âœ… Lien personnel gÃ©nÃ©rÃ©
- âœ… Colonne "Statut activation" mise Ã  jour

### 5.2 Test du trigger automatique

1. Ajoutez une nouvelle ligne test dans votre Google Sheet
2. Attendez 5 minutes (intervalle du trigger)
3. VÃ©rifiez les logs : `Vue â†’ ExÃ©cutions`
4. Confirmez que la ligne a Ã©tÃ© traitÃ©e automatiquement

### 5.3 Test du lien personnel

1. RÃ©cupÃ©rez le lien gÃ©nÃ©rÃ© (colonne "Lien personnel")
2. Ouvrez-le dans un navigateur
3. VÃ©rifiez que l'interface se charge avec les bonnes donnÃ©es

---

## ğŸ” Ã‰tape 6 : SÃ©curitÃ© & Permissions

### Permissions Gmail

Le systÃ¨me nÃ©cessite :
- âœ… `GmailApp.sendEmail` â†’ Envoi emails
- âœ… `SpreadsheetApp` â†’ Lecture/Ã©criture Sheets
- âœ… `PropertiesService` â†’ Stockage donnÃ©es
- âœ… `UrlFetchApp` â†’ Appels API (futurs)

### Gestion des accÃ¨s clients

Chaque client reÃ§oit un lien unique du type :
```
https://script.google.com/.../exec?userId=CLIENT_1699012345_a7k3p9
```

**SÃ©curitÃ© :**
- âœ… UserId non-prÃ©dictible (timestamp + random)
- âœ… Pas de mot de passe requis (lien secret)
- âœ… VÃ©rification statut compte Ã  chaque accÃ¨s
- âœ… PossibilitÃ© de suspendre un compte

---

## ğŸ“Š Ã‰tape 7 : Monitoring

### Consulter l'historique des activations

```javascript
// Dans Apps Script :
const history = getActivationHistory();
Logger.log(JSON.stringify(history, null, 2));
```

### Lister tous les clients actifs

```javascript
const clients = listAllClients();
Logger.log(`Total clients actifs : ${clients.length}`);
clients.forEach(c => {
  Logger.log(`${c.fullName} - ${c.email} - ${c.version}`);
});
```

### VÃ©rifier la configuration

```javascript
const test = testSystemConfiguration();
Logger.log(JSON.stringify(test, null, 2));
```

---

## ğŸ› ï¸ Maintenance & Debug

### Retraiter une ligne spÃ©cifique

Si une activation a Ã©chouÃ© :

```javascript
manualProcessRow(5); // Retraite la ligne 5
```

### RÃ©initialiser le tracking

âš ï¸ **Attention : cela retraitera toutes les lignes !**

```javascript
setLastProcessedRow(1); // Repart depuis la ligne 2
```

### DÃ©sinstaller le systÃ¨me

```javascript
uninstallNovaMail(); // Supprime les triggers
```

**Note :** Les donnÃ©es clients sont conservÃ©es. Pour suppression complÃ¨te, contactez l'Ã©quipe de dev.

---

## ğŸ“ˆ Ã‰volutions futures

### Phase 2 (en cours)
- âœ… Config & Core : **TerminÃ©**
- âœ… UserManagement : **TerminÃ©**
- âœ… SheetTriggers : **TerminÃ©**
- ğŸ”„ Campaigns.gs : **En cours**
- ğŸ”„ Scheduling.gs : **En cours**
- ğŸ”„ History.gs : **En cours**
- ğŸ”„ API.gs : **En cours**

### FonctionnalitÃ©s Ã  venir
- ğŸ“§ Templates d'emails avancÃ©s
- ğŸ“Š Dashboard analytics
- ğŸ”„ Campagnes rÃ©currentes
- ğŸŒ API REST pour intÃ©grations tierces
- ğŸ’³ IntÃ©gration paiements (Stripe)
- ğŸ“ Webhook notifications

---

## ğŸ†˜ Support & Troubleshooting

### ProblÃ¨mes courants

**âŒ "Source Sheet non configurÃ©"**
â†’ ExÃ©cutez `setupNovaMail()` avec les bons paramÃ¨tres

**âŒ "Permission denied"**
â†’ RÃ©autorisez les permissions dans Apps Script

**âŒ "Email non envoyÃ©"**
â†’ VÃ©rifiez votre quota Gmail quotidien (500 emails/jour)

**âŒ "Trigger ne se dÃ©clenche pas"**
â†’ VÃ©rifiez dans "DÃ©clencheurs" que le trigger existe

### Logs utiles

```javascript
// Voir toutes les propriÃ©tÃ©s script
const props = listAllScriptProperties();
Logger.log(JSON.stringify(props, null, 2));

// Voir le dernier client activÃ©
const history = getActivationHistory();
Logger.log(history[history.length - 1]);
```

---

## âœ… Checklist finale

Avant mise en production :

- [ ] Tous les fichiers .gs copiÃ©s
- [ ] index.html copiÃ©
- [ ] DÃ©ploiement web effectuÃ©
- [ ] Deployment ID configurÃ©
- [ ] Google Sheet ID enregistrÃ©
- [ ] `setupNovaMail()` exÃ©cutÃ© avec succÃ¨s
- [ ] Test manuel rÃ©ussi (manualProcessRow)
- [ ] Trigger automatique fonctionnel
- [ ] Email de bienvenue reÃ§u
- [ ] Lien personnel fonctionnel
- [ ] Monitoring en place

---

## ğŸ“ Contact

Pour toute question ou assistance :

ğŸ“§ Email : support@novamail.app  
ğŸ“š Documentation : https://docs.novamail.app  
ğŸ’¬ Discord : https://discord.gg/novamail

---

**ğŸ‰ FÃ©licitations ! Votre SaaS NovaMail est maintenant opÃ©rationnel !**
