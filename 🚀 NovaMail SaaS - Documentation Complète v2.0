# ğŸš€ NovaMail SaaS - Documentation ComplÃ¨te v2.0

## ğŸ¯ Vue d'ensemble du projet

**NovaMail** est un SaaS professionnel de gestion et d'automatisation de campagnes email, dÃ©veloppÃ© sur Google Apps Script.

### FonctionnalitÃ©s principales

âœ… **Gestion multi-versions** (FREE, STARTER, PRO, BUSINESS)  
âœ… **Activation automatique clients** depuis Tally â†’ Google Sheets  
âœ… **Espaces personnels sÃ©curisÃ©s** (liens uniques)  
âœ… **Envoi de campagnes** directes ou planifiÃ©es  
âœ… **Import destinataires** (CSV, Google Sheets)  
âœ… **Templates rÃ©utilisables**  
âœ… **PiÃ¨ces jointes** (selon version)  
âœ… **Historique centralisÃ©** dans Google Sheets  
âœ… **Quotas automatiques** par version  
âœ… **Interface responsive** TinyMCE intÃ©grÃ©e  

---

## ğŸ“¦ Architecture des fichiers

```
ğŸ“ NovaMail SaaS Project/
â”‚
â”œâ”€â”€ ğŸ“„ Config.gs              â†’ Configuration versions & quotas
â”œâ”€â”€ ğŸ“„ Core.gs                â†’ Utilitaires rÃ©utilisables
â”œâ”€â”€ ğŸ“„ UserManagement.gs      â†’ Gestion clients & activation
â”œâ”€â”€ ğŸ“„ SheetTriggers.gs       â†’ Automatisation Google Sheets
â”œâ”€â”€ ğŸ“„ Campaigns.gs           â†’ Envoi & gestion campagnes
â”œâ”€â”€ ğŸ“„ Scheduling.gs          â†’ Planification avancÃ©e
â”œâ”€â”€ ğŸ“„ History.gs             â†’ Historique centralisÃ©
â”œâ”€â”€ ğŸ“„ API.gs                 â†’ Points d'entrÃ©e frontend
â””â”€â”€ ğŸ“„ index.html             â†’ Interface utilisateur
```

---

## ğŸ”§ Installation pas Ã  pas

### Ã‰tape 1 : CrÃ©ation du projet Apps Script

1. Ouvrir [Google Apps Script](https://script.google.com)
2. CrÃ©er un nouveau projet : **"NovaMail SaaS"**
3. Copier chaque fichier artifact dans un fichier .gs correspondant
4. Respecter exactement les noms de fichiers

### Ã‰tape 2 : Configuration Google Sheet Tally

Votre Google Sheet doit contenir ces colonnes :

| Colonne | Obligatoire |
|---------|-------------|
| `Submission ID` | âœ… |
| `Nom complet` | âœ… |
| `Email de connexion` | âœ… |
| `Version activÃ©e` | âœ… (FREE/STARTER/PRO/BUSINESS) |
| `Consentement (Accepter)` | âœ… |
| `Email d'envoi` | âšª (optionnel) |
| `Email de rÃ©ponse (optionnel)` | âšª |
| `Nom de l'entreprise / organisation` | âšª |

### Ã‰tape 3 : DÃ©ploiement Web App

1. **DÃ©ployer** â†’ **Nouveau dÃ©ploiement**
2. Type : **Application Web**
3. ExÃ©cuter en tant que : **Moi**
4. AccÃ¨s : **Tout le monde**
5. Copier le **Deployment ID** (dans l'URL gÃ©nÃ©rÃ©e)

```
URL : https://script.google.com/macros/s/AKfycbzXXXXXXXXXXXXXXXX/exec
                                         ^^^^^^^^^^^^^^^^^^^^^^^^
                                         Votre Deployment ID
```

### Ã‰tape 4 : Installation automatisÃ©e

Dans Apps Script, exÃ©cuter :

```javascript
function runSetup() {
  const DEPLOYMENT_ID = "AKfycbzXXXXXXXXXXXXXXXX"; // â† Votre ID
  const SHEET_ID = "1abc...XYZ"; // â† ID de votre Google Sheet Tally
  
  const result = setupNovaMail(DEPLOYMENT_ID, SHEET_ID);
  Logger.log(JSON.stringify(result, null, 2));
}
```

**RÃ©sultat attendu :**
```json
{
  "success": true,
  "message": "NovaMail installÃ© et configurÃ© avec succÃ¨s."
}
```

---

## ğŸ”„ Flux d'automatisation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Formulaire Tally   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ Soumission auto
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Google Sheet      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ Trigger temporel (5 min)
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SheetTriggers.gs    â”‚
â”‚ onNewRowAdded()     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ Pour chaque nouvelle ligne
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UserManagement.gs   â”‚
â”‚ processNewClient()  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€ 1. GÃ©nÃ¨re userId unique
           â”œâ”€ 2. CrÃ©e objet Client
           â”œâ”€ 3. GÃ©nÃ¨re lien personnel
           â”œâ”€ 4. Sauvegarde PropertiesService
           â”œâ”€ 5. Envoie email bienvenue HTML
           â”œâ”€ 6. Met Ã  jour colonne "Statut activation"
           â””â”€ 7. Log historique
           
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client reÃ§oit      â”‚
â”‚  email + lien       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ Clic sur lien
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   doGet(e)          â”‚
â”‚ VÃ©rifie userId      â”‚
â”‚ Charge interface    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¨ Versions & Limites

| FonctionnalitÃ© | FREE | STARTER | PRO | BUSINESS |
|----------------|------|---------|-----|----------|
| Destinataires/campagne | 10 | 200 | 1000 | 5000 |
| Quota mensuel | 50 | 2000 | 10 000 | 50 000 |
| Quota annuel | 500 | 20 000 | 120 000 | 600 000 |
| PiÃ¨ces jointes | âŒ | âœ… | âœ… | âœ… |
| Import Google Sheets | âŒ | âœ… | âœ… | âœ… |
| Templates | âŒ | 5 | 20 | IllimitÃ© |
| Planification | âŒ | âœ… (48h max) | âœ… IllimitÃ©e | âœ… RÃ©currente |
| Branding personnalisÃ© | âŒ | âŒ | âœ… | âœ… |
| Support prioritaire | âŒ | âŒ | âœ… | âœ… |
| API REST | âŒ | âŒ | âŒ | âœ… |

---

## ğŸ” SÃ©curitÃ©

### GÃ©nÃ©ration userId

Format : `CLIENT_[timestamp]_[random]`

Exemple : `CLIENT_1699012345_a7k3p9`

**Avantages :**
- Non-prÃ©dictible
- Unique (timestamp + random)
- TraÃ§able (timestamp intÃ©grÃ©)

### Liens personnels

```
https://script.google.com/macros/s/DEPLOYMENT_ID/exec?userId=CLIENT_123_abc
```

**Protection :**
- âœ… UserId secret (pas de mot de passe requis)
- âœ… VÃ©rification statut compte Ã  chaque accÃ¨s
- âœ… PossibilitÃ© de suspendre un compte (`status: "suspended"`)

### Stockage des donnÃ©es

**PropertiesService :**
- Clients : `SCRIPT_PROPS:CLIENT_123_abc`
- Index : `SCRIPT_PROPS:CLIENT_INDEX`
- Quotas : `USER_PROPS:USER_QUOTA`
- Templates : `USER_PROPS:TEMPLATE:nom`

**Google Sheets :**
- Historique : Fichier unique `NovaMail_Historique`

---

## ğŸ§ª Tests & Validation

### Test 1 : Activation manuelle d'une ligne

```javascript
manualProcessRow(2); // Traite la ligne 2 du Google Sheet
```

### Test 2 : Connexion & Permissions

```javascript
const test = testConnection();
Logger.log(JSON.stringify(test, null, 2));
```

### Test 3 : Envoi de test

```javascript
sendTestToMe("Test", "<p>Hello</p>", []);
```

### Test 4 : Rapport systÃ¨me

```javascript
const report = getSystemReport();
Logger.log(JSON.stringify(report, null, 2));
```

---

## ğŸ“Š Fonctions principales exposÃ©es au frontend

### Configuration & Version

```javascript
getAppVersion() // Retourne config + quotas actuels
```

### Import Destinataires

```javascript
listGoogleSheets() // Liste sheets accessibles
importFromSheet(fileId, sheetName) // Import depuis Sheet
importCsv(csvContent) // Import depuis CSV
getLastImportedList() // DerniÃ¨re liste
```

### Templates

```javascript
saveTemplate({name, subject, htmlBody})
loadTemplate(name)
listTemplates()
deleteTemplate(name)
```

### Campagnes

```javascript
sendCampaign(recipients, subject, htmlBody, attachments)
sendTestToMe(subject, htmlBody, attachments)
scheduleCampaign({recipients, subject, htmlBody, sendAt, attachments})
```

### Planification

```javascript
getScheduledCampaigns() // Liste campagnes planifiÃ©es
updateScheduledDate(id, newDate) // Modifie date
deleteScheduledCampaign(id) // Supprime campagne
```

### Historique

```javascript
getHistoryData(limit) // RÃ©cupÃ¨re historique
getHistoryStats() // Stats globales
clearHistorySheet() // Vide tout
clearTestHistory() // Supprime tests uniquement
```

---

## ğŸ”§ Maintenance & Debug

### Consulter les logs

**Vue â†’ ExÃ©cutions** dans Apps Script

### VÃ©rifier les triggers

```javascript
const triggers = ScriptApp.getProjectTriggers();
triggers.forEach(t => {
  Logger.log(`${t.getHandlerFunction()} - ${t.getTriggerSource()}`);
});
```

### RÃ©initialiser l'historique

```javascript
resetHistoryFileId(); // Force recrÃ©ation au prochain appel
```

### Lister tous les clients

```javascript
const clients = listAllClients();
clients.forEach(c => {
  Logger.log(`${c.fullName} - ${c.email} - ${c.version}`);
});
```

### DÃ©sinstaller le systÃ¨me

```javascript
uninstallNovaMail(); // Supprime triggers uniquement
```

**Note :** Les donnÃ©es clients sont conservÃ©es dans PropertiesService.

---

## ğŸš¨ Troubleshooting

### âŒ "Source Sheet non configurÃ©"

**Solution :** ExÃ©cuter `setupNovaMail(deploymentId, sheetId)`

### âŒ "Permission denied"

**Solution :** RÃ©autoriser les permissions dans Apps Script

### âŒ "Email non envoyÃ©"

**Causes possibles :**
- Quota Gmail journalier atteint (500 emails/jour)
- Email expÃ©diteur invalide
- Permissions Gmail manquantes

**Solution :** VÃ©rifier `GmailApp.getRemainingDailyQuota()`

### âŒ "Trigger ne se dÃ©clenche pas"

**Solution :**
1. VÃ©rifier dans **DÃ©clencheurs** qu'un trigger existe
2. RÃ©installer : `reinstallMasterTrigger()`

### âŒ "Campagne planifiÃ©e non exÃ©cutÃ©e"

**Causes :**
- Trigger maÃ®tre dÃ©sactivÃ©
- Date dans le passÃ©
- Quota Ã©puisÃ© au moment de l'envoi

**Solution :** `forceExecuteCampaign(campaignId)`

---

## ğŸ“ˆ Ã‰volutions futures (Roadmap)

### Phase 2.1 (Court terme)
- [ ] A/B Testing des campagnes
- [ ] Analytics avancÃ©es (taux d'ouverture, clics)
- [ ] Interface d'administration clients
- [ ] Export historique PDF

### Phase 2.2 (Moyen terme)
- [ ] API REST complÃ¨te
- [ ] Webhooks personnalisÃ©s
- [ ] IntÃ©gration Stripe (paiements)
- [ ] Multi-langue (EN, ES, DE)

### Phase 3.0 (Long terme)
- [ ] Campagnes rÃ©currentes (BUSINESS)
- [ ] Segmentation avancÃ©e
- [ ] Machine Learning (meilleur moment d'envoi)
- [ ] Application mobile (React Native)

---

## ğŸ“ Support

### Documentation

ğŸ“š **Guide d'installation** : Voir artifact `novamail_install_guide`  
ğŸ”§ **Guide technique** : Ce document  
ğŸ“Š **Exemples de code** : Voir artifacts individuels  

### Contact

ğŸ“§ Email : support@novamail.app  
ğŸ’¬ Discord : https://discord.gg/novamail  
ğŸ› Issues : GitHub (Ã  configurer)  

### Contributions

Le code est structurÃ© pour faciliter les contributions :

1. **Modulaire** : Chaque fichier a une responsabilitÃ© unique
2. **DocumentÃ©** : JSDoc complet sur toutes les fonctions
3. **TestÃ©** : Fonctions de test intÃ©grÃ©es
4. **VersionnÃ©** : Suivi des versions dans chaque fichier

---

## âœ… Checklist de dÃ©ploiement

Avant mise en production :

- [ ] Tous les fichiers .gs copiÃ©s et sauvegardÃ©s
- [ ] index.html copiÃ© et sauvegardÃ©
- [ ] DÃ©ploiement web effectuÃ©
- [ ] Deployment ID rÃ©cupÃ©rÃ© et configurÃ©
- [ ] Google Sheet ID Tally enregistrÃ©
- [ ] `setupNovaMail()` exÃ©cutÃ© avec succÃ¨s
- [ ] Test manuel rÃ©ussi (`manualProcessRow(2)`)
- [ ] Email de bienvenue reÃ§u et vÃ©rifiÃ©
- [ ] Lien personnel fonctionnel
- [ ] Trigger automatique vÃ©rifiÃ© (aprÃ¨s 5 min)
- [ ] Test envoi campagne directe OK
- [ ] Test planification campagne OK
- [ ] Historique fonctionnel
- [ ] Quotas respectÃ©s et tracking OK

---

## ğŸ‰ RÃ©sultat final

Vous disposez maintenant d'un **SaaS professionnel, stable et Ã©volutif** pour la gestion de campagnes email, avec :

âœ… **Code refactorisÃ©** : Maintenable, commentÃ©, structurÃ©  
âœ… **Automatisation complÃ¨te** : Tally â†’ Sheet â†’ Activation â†’ Email  
âœ… **Multi-versions** : FREE Ã  BUSINESS  
âœ… **SÃ©curitÃ© renforcÃ©e** : Validation, quotas, liens uniques  
âœ… **Historique centralisÃ©** : TraÃ§abilitÃ© totale  
âœ… **Frontend prÃ©servÃ©** : Noms de fonctions conservÃ©s  
âœ… **ExtensibilitÃ©** : PrÃªt pour nouvelles features  

---

## ğŸ“ Notes de version

### v2.0.0 (2025-11-03)
- âœ… Refactoring complet du backend
- âœ… Architecture modulaire (8 fichiers)
- âœ… Gestion automatisÃ©e des clients
- âœ… SystÃ¨me de quotas par version
- âœ… Historique avancÃ©
- âœ… API standardisÃ©e
- âœ… Documentation complÃ¨te

### v1.0.0 (2025-10-31)
- âœ… Version initiale fonctionnelle
- âš ï¸ Code monolithique (Ã  refactorer)

---

**ğŸš€ Bon lancement avec NovaMail SaaS !**
